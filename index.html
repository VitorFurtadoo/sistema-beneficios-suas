<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Benefícios Eventuais</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="loading-overlay">
        <div class="spinner"></div>
        <p>Carregando...</p>
    </div>

    <header>
        <div class="header-logo">
            <img src="imagens/logo_semdes.png" alt="Logo SEMDES" class="logo">
            <h1>Sistema de Benefícios Eventuais</h1>
        </div>
        <div class="user-info">
            <span id="welcome-message"></span>
            <button id="logout-btn" class="secondary-btn">Sair</button>
        </div>
    </header>

    <div class="main-menu" id="mainMenu">
        <button class="menu-btn btn-cadastrar" data-section="cadastrarSection">Cadastrar Benefício</button>
        <button class="menu-btn btn-consultar" data-section="consultaSection">Consultar Benefícios</button>
        <button class="menu-btn btn-graficos" data-section="graficosSection">Gráficos</button>
        <button class="menu-btn btn-admin" data-section="adminSection" id="adminMenuButton" style="display:none;">Admin</button>
    </div>

    <section id="cadastrarSection" class="section">
        <button class="back-btn" data-section="mainMenu">← Voltar</button>
        <h2>Cadastrar Benefício</h2>
        <form id="beneficioForm" class="form-grid">
            <div class="form-group">
                <label>Beneficiário</label>
                <input type="text" name="beneficiario" placeholder="Nome do beneficiário" required>
            </div>
            <div class="form-group">
                <label>CPF</label>
                <input type="text" name="cpf" placeholder="000.000.000-00" required>
            </div>
            <div class="form-group">
                <label>Data</label>
                <input type="date" name="data" required>
            </div>
            <div class="form-group">
                <label>Valor</label>
                <input type="number" name="valor" step="0.01" min="0" placeholder="0.00" required>
            </div>
            <div class="form-group">
                <label>Benefício</label>
                <select name="beneficio">
                    <option value="" disabled selected>Selecione o benefício...</option>
                    <option value="Auxilio Natalidade (Kit Enxoval)">Auxilio Natalidade (Kit Enxoval)</option>
                    <option value="Auxilio Alimentação (Cesta Básica)">Auxilio Alimentação (Cesta Básica)</option>
                    <option value="Auxilio Funeral">Auxilio Funeral</option>
                    <option value="Auxilio Transporte (Passagens)">Auxilio Transporte (Passagens)</option>
                    <option value="Alugel Social">Alugel Social</option>
                </select>
            </div>
            <div class="form-group">
                <label>Quantidade</label>
                <input type="number" name="quantidade" min="0" placeholder="0" required>
            </div>
            <div class="form-group">
                <label>Equipamento</label>
                <select name="equipamento">
                    <option value="" disabled selected>Selecione o equipamento...</option>
                    <option value="CREAS">CREAS</option>       
                    <option value="CRAS Camboatã">CRAS Camboatã</option>
                    <option value="Cras Jaderlândia">Cras Jaderlândia</option>
                    <option value="Cras Morada do Sol">Cras Morada do Sol</option>
                    <option value="Cras Nagibão">Cras Nagibão</option>
                    <option value="Abrigo de Idosos">Abrigo de Idosos</option>
                    <option value="Abrigo de Crianças">Abrigo de Crianças</option>
                </select>
            </div>
            <div class="form-group">
                <label>Responsável</label>
                <input type="text" name="responsavel" placeholder="Nome do responsável">
            </div>
            <div class="form-group">
                <label>Status</label>
                <select name="status">
                    <option value="Cedido">Cedido</option>
                    <option value="Pendente">Pendente</option>
                    <option value="Negado">Negado</option>
                </select>
            </div>
            <div class="form-group full-width">
                <label>Observações</label>
                <textarea name="observacoes" placeholder="Adicione informações adicionais, se houver..."></textarea>
            </div>
            <div class="form-group full-width form-submit-btn">
                <button type="submit" class="submit-btn">Cadastrar</button>
            </div>
        </form>
    </section>

    <section id="consultaSection" class="section">
        <button class="back-btn" data-section="mainMenu">← Voltar</button>
        <h2>Consultar Benefícios</h2>
        
        <div class="filter-container">
            <div class="filter-group">
                <label for="filter-nome">Nome:</label>
                <input type="text" id="filter-nome" name="nome" placeholder="Digite o nome do beneficiário">
            </div>
            <div class="filter-group">
                <label for="filter-cpf">CPF:</label>
                <input type="text" id="filter-cpf" name="cpf" placeholder="000.000.000-00">
            </div>
            <div class="filter-group">
                <label for="filter-data-start">De:</label>
                <input type="date" id="filter-data-start" name="data-start">
            </div>
            <div class="filter-group">
                <label for="filter-data-end">Até:</label>
                <input type="date" id="filter-data-end" name="data-end">
            </div>
            <div class="filter-group">
                <label for="filter-status">Status:</label>
                <select id="filter-status" name="status">
                    <option value="">Todos</option>
                    <option value="Cedido">Cedido</option>
                    <option value="Pendente">Pendente</option>
                    <option value="Negado">Negado</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-equipamento">Equipamento:</label>
                <select id="filter-equipamento" name="equipamento">
                    <option value="">Todos</option>
                    <option value="CREAS">CREAS</option>
                    <option value="CRAS Camboatã">CRAS Camboatã</option>
                    <option value="Cras Jaderlândia">Cras Jaderlândia</option>
                    <option value="Cras Morada do Sol">Cras Morada do Sol</option>
                    <option value="Cras Nagibão">Cras Nagibão</option>
                    <option value="Abrigo de Idosos">Abrigo de Idosos</option>
                    <option value="Abrigo de Crianças">Abrigo de Crianças</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-beneficio">Benefício:</label>
                <select id="filter-beneficio" name="beneficio">
                    <option value="">Todos</option>
                    <option value="Auxilio Natalidade (Kit Enxoval)">Auxilio Natalidade (Kit Enxoval)</option>
                    <option value="Auxilio Alimentação (Cesta Básica)">Auxilio Alimentação (Cesta Básica)</option>
                    <option value="Auxilio Funeral">Auxilio Funeral</option>
                    <option value="Auxilio Transporte (Passagens)">Auxilio Transporte (Passagens)</option>
                    <option value="Alugel Social">Alugel Social</option>
                </select>
            </div>
            <div class="filter-actions">
                <button id="apply-filters-btn" class="submit-btn">Aplicar Filtros</button>
                <button id="clear-filters-btn" class="secondary-btn">Limpar Filtros</button>
                <button id="btn-exportar-csv" class="export-btn">Exportar Excel</button>
            </div>
        </div>
        <div class="table-wrapper">
            <table id="beneficiosTable">
                <thead>
                    <tr>
                        <th>Beneficiário</th><th>CPF</th><th>Data</th><th>Valor</th>
                        <th>Benefício</th><th>Qtd</th><th>Equipamento</th><th>Responsável</th>
                        <th>Status</th><th>Observações</th><th>Última Atualização</th><th>Ações</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </section>

    <section id="editSection" class="section">
        <button class="back-btn" data-section="consultaSection">← Voltar</button>
        <h2>Editar Benefício</h2>
        <form id="editForm" class="form-grid">
            <input type="hidden" id="editIndex">
            <div class="form-group"><label>Beneficiário</label><input type="text" id="edit-beneficiario" name="beneficiario" required></div>
            <div class="form-group"><label>CPF</label><input type="text" id="edit-cpf" name="cpf" required></div>
            <div class="form-group"><label>Data</label><input type="date" id="edit-data" name="data" required></div>
            <div class="form-group"><label>Valor</label><input type="number" id="edit-valor" name="valor" min="0" step="0.01" required></div>
            <div class="form-group"><label>Benefício</label><input type="text" id="edit-beneficio" name="beneficio" required></div>
            <div class="form-group"><label>Quantidade</label><input type="number" id="edit-quantidade" name="quantidade" min="0"></div>
            <div class="form-group"><label>Equipamento</label><input type="text" id="edit-equipamento" name="equipamento"></div>
            <div class="form-group"><label>Responsável</label><input type="text" id="edit-responsavel" name="responsavel"></div>
            <div class="form-group"><label>Status</label><select id="edit-status" name="status"><option>Cedido</option><option>Pendente</option><option>Negado</option></select></div>
            <div class="form-group full-width"><label>Observações</label><textarea id="edit-observacoes" name="observacoes"></textarea></div>
            <div class="form-group full-width"><button type="submit" class="submit-btn">Atualizar</button></div>
        </form>
    </section>

    <section id="graficosSection" class="section">
        <button class="back-btn" data-section="mainMenu">← Voltar</button>
        <h2>Gráficos de Benefícios</h2>
        
        <div class="chart-box">
            <p class="chart-description">Gráfico de Barras: Exibe a quantidade de benefícios por período.</p>
            <div class="filter-container chart-filters">
                <div class="filter-group">
                    <label for="grafico-data-start">Data Inicial:</label>
                    <input type="date" id="grafico-data-start">
                </div>
                <div class="filter-group">
                    <label for="grafico-data-end">Data Final:</label>
                    <input type="date" id="grafico-data-end">
                </div>
                <div class="filter-group">
                    <label for="grafico-periodo-filtro">Agrupar por:</label>
                    <select id="grafico-periodo-filtro">
                        <option value="mensal">Mensal</option>
                        <option value="trimestral">Trimestral (3 em 3 meses)</option>
                        <option value="semestral">Semestral (6 em 6 meses)</option>
                        <option value="anual">Anual</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="grafico-status-filtro">Status:</label>
                    <select id="grafico-status-filtro">
                        <option value="Todos">Todos</option>
                        <option value="Cedido">Cedido</option>
                        <option value="Pendente">Pendente</option>
                        <option value="Negado">Negado</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="grafico-beneficio-filtro">Filtrar Benefício:</label>
                    <select id="grafico-beneficio-filtro">
                        <option value="Todos">Todos</option>
                        <option value="Auxilio Natalidade (Kit Enxoval)">Auxilio Natalidade (Kit Enxoval)</option>
                        <option value="Auxilio Alimentação (Cesta Básica)">Auxilio Alimentação (Cesta Básica)</option>
                        <option value="Auxilio Funeral">Auxilio Funeral</option>
                        <option value="Auxilio Transporte (Passagens)">Auxilio Transporte (Passagens)</option>
                        <option value="Alugel Social">Alugel Social</option>
                    </select>
                </div>
            </div>
            
            <p id="total-valor-grafico" class="valor-total"></p>

            <div class="graficos-container chart-container" id="grafico-periodo-container">
                <canvas id="grafico-periodo"></canvas>
            </div>
            <div class="controls chart-controls">
                <button id="gerar-grafico-periodo" class="submit-btn">Gerar Gráfico</button>
                <button id="salvar-imagem-periodo" class="export-btn">Salvar Imagem</button>
            </div>
            <div id="legenda-periodo" class="chart-legend"></div>
        </div>

        <hr>

        <div class="chart-box">
            <p class="chart-description">Gráfico de Pizza: Mostra a distribuição percentual dos benefícios por equipamento.</p>
            <div class="filter-container chart-filters">
                <div class="filter-group">
                    <label for="grafico-equipamento-status-filtro">Status:</label>
                    <select id="grafico-equipamento-status-filtro">
                        <option value="Todos">Todos</option>
                        <option value="Cedido">Cedido</option>
                        <option value="Pendente">Pendente</option>
                        <option value="Negado">Negado</option>
                    </select>
                </div>
            </div>
            <div class="graficos-container" id="grafico-equipamento-container">
                <canvas id="grafico-equipamento"></canvas>
            </div>
            <div class="controls chart-controls">
                <button id="gerar-grafico-equipamento" class="submit-btn">Gerar Gráfico</button>
                <button id="salvar-imagem-equipamento" class="export-btn">Salvar Imagem</button>
            </div>
            <div id="legenda-equipamento" class="chart-legend"></div>
        </div>
    </section>

    <section id="adminSection" class="section">
        <button class="back-btn" data-section="mainMenu">← Voltar</button>
        <h2>Administração de Usuários</h2>
        <div class="table-wrapper">
            <table id="usersTable">
                <thead>
                    <tr>
                        <th>Usuário</th>
                        <th>Função</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>
        <hr>
        <h2>Histórico de Atividades</h2>
        <div class="filter-container">
            <div class="filter-group">
                <label for="logs-date-start">De:</label>
                <input type="date" id="logs-date-start">
            </div>
            <div class="filter-group">
                <label for="logs-date-end">Até:</label>
                <input type="date" id="logs-date-end">
            </div>
            <div class="filter-group">
                <label for="logs-action-filter">Ação:</label>
                <select id="logs-action-filter">
                    <option value="">Todas</option>
                    <option value="user_login">Login</option>
                    <option value="user_logout">Logout</option>
                    <option value="create_beneficio">Criar Benefício</option>
                    <option value="edit_beneficio">Editar Benefício</option>
                    <option value="delete_beneficio">Excluir Benefício</option>
                    <option value="apply_filters">Aplicar Filtros</option>
                    <option value="export_excel">Exportar Excel</option>
                    <option value="navigate_section">Navegar Seção</option>
                </select>
            </div>
            <div class="filter-actions">
                <button id="apply-logs-filter-btn" class="submit-btn">Filtrar Logs</button>
                <button id="clear-logs-filter-btn" class="secondary-btn">Limpar Filtro</button>
                <button id="clear-old-logs-btn" class="delete-btn">Limpar Logs Antigos (30+ dias)</button>
            </div>
        </div>
        <div class="table-wrapper">
            <table id="logsTable">
                <thead>
                    <tr>
                        <th>Data e Hora</th>
                        <th>Usuário</th>
                        <th>Descrição</th>
                        <th>Ação</th>
                        <th>ID do Usuário</th>
                        <th>Navegador</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>
    </section>

    <!-- Modal de confirmação para duplicatas -->
    <div id="duplicateModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>⚠️ Possível Duplicação Encontrada</h3>
                <span class="close" id="closeDuplicateModal">&times;</span>
            </div>
            <div class="modal-body">
                <p>Encontramos cadastros existentes para este CPF e/ou nome:</p>
                <div id="duplicateRecords"></div>
                <p><strong>Deseja continuar com o cadastro?</strong></p>
            </div>
            <div class="modal-footer">
                <button id="confirmCadastro" class="submit-btn">Sim, Cadastrar Mesmo Assim</button>
                <button id="cancelCadastro" class="secondary-btn">Cancelar</button>
            </div>
        </div>
    </div>

    <footer class="app-footer">
        <div class="footer-content">
            <p class="copyright">
                © 2025 Sistema de Benefícios Eventuais - SEMDES Paragominas
            </p>
            <p class="developer-info">
                Desenvolvido por <strong>Vitor Furtado</strong> | Vigilância SUAS Paragominas
            </p>
            <p class="version-info">
                Versão 1.0 | Todos os direitos reservados
            </p>
        </div>
    </footer>

    <script src="js/script.js"></script>
</body>
</html>